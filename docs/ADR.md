# Architecture Decision Records (ADR)

**Версия:** 1.0  
**Дата:** Февраль 2026

---

## ADR-001: Выбор Kotlin вместо Java

**Статус:** Принято  
**Дата:** Январь 2024

### Контекст

При разработке Android приложения для промышленного использования необходимо было выбрать язык программирования. Традиционно для Android используется Java, но Kotlin предлагает современные возможности.

### Решение

Использовать Kotlin как основной язык разработки для всего проекта.

### Обоснование

1. **Null-safety:** Встроенная система типов Kotlin предотвращает NullPointerException, критически важные для промышленных приложений
2. **Корутины:** Нативная поддержка асинхронного программирования упрощает работу с сетью и файлами
3. **Современный синтаксис:** Более читаемый и лаконичный код по сравнению с Java
4. **100% совместимость с Java:** Возможность использования существующих Java библиотек
5. **Официальная поддержка Google:** Kotlin является официальным языком для Android разработки

### Последствия

**Положительные:**
- Улучшенная безопасность типов снижает количество runtime ошибок
- Более читаемый код упрощает поддержку и развитие проекта
- Корутины упрощают асинхронное программирование

**Отрицательные:**
- Необходимость обучения команды Kotlin (если команда знала только Java)
- Некоторые библиотеки могут иметь лучшую поддержку для Java

**Нейтральные:**
- Проект может использовать Java библиотеки без изменений

---

## ADR-002: Offline-first архитектура

**Статус:** Принято  
**Дата:** Январь 2024

### Контекст

Приложение должно работать на промышленном объекте ВК-50, где операторы работают в экранированных зонах (цеха, подвальные помещения) без доступа к интернету. Критически важно обеспечить доступ к данным в любой момент.

### Решение

Реализовать offline-first подход с локальным кэшированием данных через SQLite и File Cache.

### Обоснование

1. **Критическая важность доступа к данным:** Операторы должны иметь доступ к схемам и данным в любой момент, независимо от наличия связи
2. **Производительность:** Локальное кэширование обеспечивает мгновенный доступ к данным
3. **Надежность:** Работа не зависит от состояния сети
4. **Синхронизация:** Данные синхронизируются с сервером при наличии связи через WorkManager

### Архитектурные компоненты

- **SQLite:** Локальная база данных для структурированных данных
- **File Cache:** Кэширование Excel и PDF файлов в файловой системе
- **WorkManager:** Фоновая синхронизация данных с сервером
- **DataRefreshManager:** Автоматическое обновление данных при изменении файлов

### Последствия

**Положительные:**
- Гарантированный доступ к данным в офлайн-режиме
- Высокая производительность за счет локального кэширования
- Надежность работы независимо от состояния сети

**Отрицательные:**
- Увеличение размера приложения из-за локального кэша
- Необходимость управления синхронизацией данных
- Риск устаревания данных при длительном офлайн-режиме

**Митигация:**
- Индикация статуса синхронизации для пользователя
- Автоматическая проверка обновлений при наличии связи
- Валидация целостности данных при синхронизации

---

## ADR-003: Использование Apache POI для работы с Excel

**Статус:** Принято  
**Дата:** Февраль 2024

### Контекст

Приложение должно работать с массивными Excel-таблицами технических данных (размером до 50 МБ). Необходимо обеспечить надежный парсинг и отображение данных с сохранением форматирования.

### Решение

Использовать Apache POI 5.2.5 для парсинга и работы с Excel файлами (.xlsx).

### Обоснование

1. **Надежность:** Apache POI — проверенная временем библиотека с высокой надежностью
2. **Поддержка больших файлов:** Эффективная работа с файлами размером до 50 МБ
3. **Точность парсинга:** Гарантирует 100% точность при чтении данных из Excel
4. **Сохранение форматирования:** Поддержка стилей, формул и форматирования ячеек
5. **Активная поддержка:** Регулярные обновления и исправления ошибок

### Альтернативы, которые были рассмотрены

1. **JExcelAPI:** Устаревшая библиотека, не поддерживает .xlsx формат
2. **ExcelJet:** Менее функциональная, не подходит для сложных файлов
3. **Собственная реализация:** Слишком сложно и рискованно

### Последствия

**Положительные:**
- Надежный парсинг больших Excel файлов
- Сохранение форматирования при экспорте
- Поддержка формул и вычислений

**Отрицательные:**
- Увеличение размера APK (~5 МБ)
- Необходимость оптимизации памяти при работе с большими файлами
- ProGuard может вызывать проблемы с рефлексией (отключен в проекте)

**Митигация:**
- Постраничная загрузка данных для оптимизации памяти
- Кэширование распарсенных данных
- Валидация размера файлов перед загрузкой

---

## ADR-004: Material 3 для UI

**Статус:** Принято  
**Дата:** Март 2024

### Контекст

Необходимо создать современный, интуитивный интерфейс с высокой контрастностью для минимизации когнитивной нагрузки на оператора в промышленных условиях.

### Решение

Использовать Material Design 3 (Material You) для создания пользовательского интерфейса.

### Обоснование

1. **Современный дизайн:** Material 3 предоставляет современные компоненты и паттерны
2. **Высокая контрастность:** Поддержка темной и светлой тем для различных условий освещения
3. **Адаптивность:** Автоматическая адаптация под различные размеры экранов
4. **Доступность:** Встроенная поддержка accessibility функций
5. **Кастомизация:** Возможность создания собственных тем (6 профессиональных тем в проекте)

### Последствия

**Положительные:**
- Современный и интуитивный интерфейс
- Высокая контрастность для промышленных условий
- Поддержка различных тем оформления

**Отрицательные:**
- Требует Android API 31+ для полной поддержки Material 3
- Необходимость кастомизации для специфических требований

---

## ADR-005: MVVM архитектура

**Статус:** Принято  
**Дата:** Январь 2024

### Контекст

Необходимо обеспечить разделение ответственности между UI и бизнес-логикой для упрощения тестирования и поддержки кода.

### Решение

Использовать MVVM (Model-View-ViewModel) архитектурный паттерн.

### Обоснование

1. **Разделение ответственности:** Четкое разделение между UI и бизнес-логикой
2. **Тестируемость:** Легкое тестирование ViewModel независимо от UI
3. **Реактивность:** Использование LiveData для реактивного обновления UI
4. **Стандарт Android:** Рекомендуемый Google подход для Android разработки

### Архитектурные компоненты

- **View:** Fragments и Activities (UI слой)
- **ViewModel:** Управление состоянием и бизнес-логикой
- **Model:** Repository для работы с данными
- **Repository:** Абстракция над источниками данных (локальные и сетевые)

### Последствия

**Положительные:**
- Упрощение тестирования бизнес-логики
- Улучшенная поддерживаемость кода
- Реактивное обновление UI

**Отрицательные:**
- Небольшое увеличение сложности архитектуры
- Необходимость обучения команды MVVM паттерну

---

## Резюме

Все архитектурные решения были приняты с учетом специфики промышленного приложения и требований к надежности, производительности и доступности данных. Каждое решение было обосновано и проанализировано с точки зрения последствий для проекта.
